<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #log {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Audio Test Page</h1>

    <h2>Simple HTML5 Audio Test</h2>
    <audio id="sixAudio" controls>
        <source src="Music/Six_hit.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <audio id="wicketAudio" controls>
        <source src="Music/Wicket_fallen.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <h2>JavaScript Audio Test</h2>
    <button onclick="testAudioContext()">Test AudioContext</button>
    <button onclick="testSixSound()">Test Six Sound</button>
    <button onclick="testWicketSound()">Test Wicket Sound</button>
    <button onclick="testFileAccess()">Test File Access</button>

    <div id="log"></div>

    <script>
        const logDiv = document.getElementById('log');
        let audioContext = null;
        let soundBuffers = {};

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(div);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function testAudioContext() {
            log('Testing AudioContext...');

            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                log(`AudioContext created successfully. State: ${audioContext.state}`, 'success');

                audioContext.onstatechange = () => {
                    log(`AudioContext state changed to: ${audioContext.state}`, 'info');
                };

                if (audioContext.state === 'suspended') {
                    log('AudioContext is suspended, attempting to resume...', 'info');
                    audioContext.resume().then(() => {
                        log('AudioContext resumed successfully', 'success');
                    }).catch(err => {
                        log(`Failed to resume AudioContext: ${err}`, 'error');
                    });
                }
            } catch (error) {
                log(`Failed to create AudioContext: ${error}`, 'error');
            }
        }

        async function testFileAccess() {
            log('Testing file access...', 'info');

            const files = [
                'Music/Six_hit.mp3',
                './Music/Six_hit.mp3',
                '/Music/Six_hit.mp3',
                'Music/Wicket_fallen.mp3',
                './Music/Wicket_fallen.mp3',
                '/Music/Wicket_fallen.mp3'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(file, { method: 'HEAD' });
                    if (response.ok) {
                        log(`✅ File accessible: ${file} (${response.status})`, 'success');
                    } else {
                        log(`❌ File not accessible: ${file} (${response.status})`, 'error');
                    }
                } catch (error) {
                    log(`❌ Error accessing ${file}: ${error.message}`, 'error');
                }
            }
        }

        async function loadSound(url) {
            log(`Loading sound from: ${url}`, 'info');

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

                log(`✅ Sound loaded successfully: ${url} (${audioBuffer.duration.toFixed(2)}s)`, 'success');
                return audioBuffer;
            } catch (error) {
                log(`❌ Failed to load sound ${url}: ${error.message}`, 'error');
                return null;
            }
        }

        async function playSound(buffer, volume = 0.7) {
            if (!buffer || !audioContext) {
                log('Cannot play sound - no buffer or AudioContext', 'error');
                return;
            }

            try {
                if (audioContext.state === 'suspended') {
                    log('Resuming AudioContext before playback...', 'info');
                    await audioContext.resume();
                }

                const source = audioContext.createBufferSource();
                const gainNode = audioContext.createGain();

                source.buffer = buffer;
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);

                source.connect(gainNode);
                gainNode.connect(audioContext.destination);

                source.start();
                log('🎵 Sound started playing', 'success');
            } catch (error) {
                log(`❌ Failed to play sound: ${error.message}`, 'error');
            }
        }

        async function testSixSound() {
            log('Testing Six sound...', 'info');

            if (!audioContext) {
                log('AudioContext not initialized, creating...', 'info');
                await testAudioContext();
            }

            const buffer = await loadSound('Music/Six_hit.mp3');
            if (buffer) {
                await playSound(buffer);
            }
        }

        async function testWicketSound() {
            log('Testing Wicket sound...', 'info');

            if (!audioContext) {
                log('AudioContext not initialized, creating...', 'info');
                await testAudioContext();
            }

            const buffer = await loadSound('Music/Wicket_fallen.mp3');
            if (buffer) {
                await playSound(buffer);
            }
        }

        // Auto-test on page load
        window.onload = () => {
            log('Audio test page loaded', 'info');
            testFileAccess();
        };
    </script>
</body>
</html>